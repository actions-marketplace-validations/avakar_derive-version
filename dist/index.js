module.exports=function(e,t){"use strict";var r={};function __webpack_require__(t){if(r[t]){return r[t].exports}var n=r[t]={i:t,l:false,exports:{}};e[t].call(n.exports,n,n.exports,__webpack_require__);n.l=true;return n.exports}__webpack_require__.ab=__dirname+"/";function startup(){return __webpack_require__(936)}return startup()}({87:function(e){e.exports=require("os")},129:function(e){e.exports=require("child_process")},445:function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(Object.hasOwnProperty.call(e,r))t[r]=e[r];t["default"]=e;return t};Object.defineProperty(t,"__esModule",{value:true});const i=n(r(87));function issueCommand(e,t,r){const n=new Command(e,t,r);process.stdout.write(n.toString()+i.EOL)}t.issueCommand=issueCommand;function issue(e,t=""){issueCommand(e,{},t)}t.issue=issue;const s="::";class Command{constructor(e,t,r){if(!e){e="missing.command"}this.command=e;this.properties=t;this.message=r}toString(){let e=s+this.command;if(this.properties&&Object.keys(this.properties).length>0){e+=" ";let t=true;for(const r in this.properties){if(this.properties.hasOwnProperty(r)){const n=this.properties[r];if(n){if(t){t=false}else{e+=","}e+=`${r}=${escapeProperty(n)}`}}}}e+=`${s}${escapeData(this.message)}`;return e}}function escapeData(e){return(e||"").replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function escapeProperty(e){return(e||"").replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}},622:function(e){e.exports=require("path")},747:function(e){e.exports=require("fs")},848:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,i){function fulfilled(e){try{step(n.next(e))}catch(e){i(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){i(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())})};var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(Object.hasOwnProperty.call(e,r))t[r]=e[r];t["default"]=e;return t};Object.defineProperty(t,"__esModule",{value:true});const s=r(445);const o=i(r(87));const u=i(r(622));var a;(function(e){e[e["Success"]=0]="Success";e[e["Failure"]=1]="Failure"})(a=t.ExitCode||(t.ExitCode={}));function exportVariable(e,t){process.env[e]=t;s.issueCommand("set-env",{name:e},t)}t.exportVariable=exportVariable;function setSecret(e){s.issueCommand("add-mask",{},e)}t.setSecret=setSecret;function addPath(e){s.issueCommand("add-path",{},e);process.env["PATH"]=`${e}${u.delimiter}${process.env["PATH"]}`}t.addPath=addPath;function getInput(e,t){const r=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!r){throw new Error(`Input required and not supplied: ${e}`)}return r.trim()}t.getInput=getInput;function setOutput(e,t){s.issueCommand("set-output",{name:e},t)}t.setOutput=setOutput;function setFailed(e){process.exitCode=a.Failure;error(e)}t.setFailed=setFailed;function debug(e){s.issueCommand("debug",{},e)}t.debug=debug;function error(e){s.issue("error",e)}t.error=error;function warning(e){s.issue("warning",e)}t.warning=warning;function info(e){process.stdout.write(e+o.EOL)}t.info=info;function startGroup(e){s.issue("group",e)}t.startGroup=startGroup;function endGroup(){s.issue("endgroup")}t.endGroup=endGroup;function group(e,t){return n(this,void 0,void 0,function*(){startGroup(e);let r;try{r=yield t()}finally{endGroup()}return r})}t.group=group;function saveState(e,t){s.issueCommand("save-state",{name:e},t)}t.saveState=saveState;function getState(e){return process.env[`STATE_${e}`]||""}t.getState=getState},936:function(e,t,r){const n=r(848);const i=r(129);const s=r(747);function runGit(e){return i.execFileSync("git",e,{encoding:"ascii"}).trim()}function readShallow(){try{const e=s.readFileSync(".git/shallow",{encoding:"ascii"});return new Set(e.trim().split("\n"))}catch{return new Set}}function resolveBlob(e,t){const[r,n,i]=runGit(["ls-tree",e,t]).split("\t",1)[0].split(" ");if(n!="blob"){return null}else{return i}}class Walker{constructor(e,t){this._filename=e;this._blobId=resolveBlob(t,e);this._boundary=new Map;this._boundary.set(t,0);this._depth=0;this.updateShallow()}updateShallow(){this._shallow=readShallow()}_processLine(e){e=e.trim();if(e.size==0){return true}let[t,...r]=e.split(" ");let n=this._boundary.get(t);if(n!==undefined){if(this._shallow.has(t)){return false}this._boundary.delete(t);if(resolveBlob(t,this._filename)===this._blobId){if(this._depth<n){this._depth=n}for(const e of r){const t=this._boundary.get(e);if(t===undefined||t<n+1){this._boundary.set(e,n+1)}}}}return true}walk(){const e=this;return new Promise((t,r)=>{const n=i.spawn("git",["log","--topo-order","--format=format:%H %P",...e._boundary.keys()],{stdio:["ignore","pipe","inherit"]});function kill(){n.stdout.removeAllListeners();n.removeAllListeners();n.kill();n.unref()}function processLine(r){if(!e._processLine(r)){kill();t(null);return true}if(e._boundary.size==0){kill();t(e._depth);return true}return false}let s="";n.stdout.on("data",e=>{try{s+=e;let t=s.indexOf("\n");while(t>=0){let e=s.slice(0,t);s=s.slice(t+1);if(processLine(e)){return}t=s.indexOf("\n")}}catch(e){kill();r(e)}});n.on("close",e=>{try{if(e!==0){throw new Error("git log failed")}if(s.length==0||!processLine(s)){throw new Error("internal algorithm error")}}catch(e){kill();r(e)}})})}}async function main(){const e=n.getInput("commit",{required:true});const t=n.getInput("file",{required:true});const r=parseInt(n.getInput("deepen-by",{required:true}));const i=runGit(["rev-parse","--verify",e]);const s=runGit(["show",`${i}:${t}`]);const o=new Walker(t,i);let u;while((u=await o.walk())===null){n.info(`The repo is too shallow, deepening it by ${r} commits...`);runGit(["fetch",`--deepen=${r}`]);o.updateShallow()}n.info(`Version ${s}.${u}`);n.setOutput("version",`${s}.${u}`);n.setOutput("patch",`${u}`)}main().catch(function(e){n.setFailed(e.message)})}});